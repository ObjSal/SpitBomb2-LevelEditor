'use strict';function _defineProperty(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}import{Bomb}from"./bomb.js";export class Player{constructor(a,b,c,d){this.x=a;this.y=b;this.width=Player.size;this.height=Player.size;this.map=d;this.direction=Player.Direction.South;this.action=Player.Action.Closed;this.loadImages(c);this.lastBombCreatedTime=performance.now();this.bombs=[]}loadImages(a){this.imageMap={};this.imageMap[Player.Direction.South]={};this.imageMap[Player.Direction.SouthWest]={};this.imageMap[Player.Direction.SouthEast]={};this.imageMap[Player.Direction.West]={};this.imageMap[Player.Direction.East]={};this.imageMap[Player.Direction.North]={};this.imageMap[Player.Direction.NorthWest]={};this.imageMap[Player.Direction.NorthEast]={};this.imageMap[Player.Direction.South][Player.Action.Open]=this.loadImage(`${a}-south-open.png`);this.imageMap[Player.Direction.South][Player.Action.Closed]=this.loadImage(`${a}-south-closed.png`);this.imageMap[Player.Direction.SouthWest][Player.Action.Open]=this.loadImage(`${a}-southwest-open.png`);this.imageMap[Player.Direction.SouthWest][Player.Action.Closed]=this.loadImage(`${a}-southwest-closed.png`);this.imageMap[Player.Direction.SouthEast][Player.Action.Open]=this.loadImage(`${a}-southeast-open.png`);this.imageMap[Player.Direction.SouthEast][Player.Action.Closed]=this.loadImage(`${a}-southeast-closed.png`);this.imageMap[Player.Direction.West][Player.Action.Open]=this.loadImage(`${a}-west-open.png`);this.imageMap[Player.Direction.West][Player.Action.Closed]=this.loadImage(`${a}-west-closed.png`);this.imageMap[Player.Direction.East][Player.Action.Open]=this.loadImage(`${a}-east-open.png`);this.imageMap[Player.Direction.East][Player.Action.Closed]=this.loadImage(`${a}-east-closed.png`);this.imageMap[Player.Direction.North][Player.Action.Open]=this.loadImage(`${a}-north.png`);this.imageMap[Player.Direction.North][Player.Action.Closed]=this.loadImage(`${a}-north.png`);this.imageMap[Player.Direction.NorthWest][Player.Action.Open]=this.loadImage(`${a}-northwest-open.png`);this.imageMap[Player.Direction.NorthWest][Player.Action.Closed]=this.loadImage(`${a}-northwest-closed.png`);this.imageMap[Player.Direction.NorthEast][Player.Action.Open]=this.loadImage(`${a}-northeast-open.png`);this.imageMap[Player.Direction.NorthEast][Player.Action.Closed]=this.loadImage(`${a}-northeast-closed.png`)}loadImage(a){let b=new Image;b.src=a;return b}setDirection(a,b){if(a>0&&b>0){this.direction=Player.Direction.SouthEast}else if(a>0&&b<0){this.direction=Player.Direction.NorthEast}else if(a>0&&b===0){this.direction=Player.Direction.East}else if(a<0&&b>0){this.direction=Player.Direction.SouthWest}else if(a<0&&b<0){this.direction=Player.Direction.NorthWest}else if(a<0&&b===0){this.direction=Player.Direction.West}else if(a===0&&b>0){this.direction=Player.Direction.South}else if(a===0&&b<0){this.direction=Player.Direction.North}}move(a,b){this.setDirection(a,b);let c,d;if(a!==0){c=Math.max(0,Math.min(this.map.width-this.width,this.x+a))}if(b!==0){d=Math.max(0,Math.min(this.map.height-this.height,this.y+b))}if(a!==0||b!==0){const e=4;let f=false;let g=false;for(let h of this.map.blocks){if(a!==0&&!f&&h.hitTest(c+e,this.y+e,this.width-e*2,this.height-e*2)){f=true}if(b!==0&&!g&&h.hitTest(this.x+e,d+e,this.width-e*2,this.height-e*2)){g=true}if(g&&f)break}if(a!==0&&!f){this.x=c}if(b!==0&&!g){this.y=d}}}fire(){if(performance.now()-this.lastBombCreatedTime>300){this.lastBombCreatedTime=performance.now();let a=this.x+(this.width-Bomb.size)/2,b=this.y+(this.height-Bomb.size)/2;if(this.direction===Player.Direction.East||this.direction===Player.Direction.West){a=this.x+this.width/2;b=this.y+this.height/2}let c=new Bomb(a,b,this.direction,this.map);this.bombs.push(c)}}updateBombs(a){let b=[];for(let c=this.bombs.length-1;c>=0;c--){let d=this.bombs[c];if(d.update(a)){b.push(c)}}for(let c of b){this.bombs.splice(c,1)}}drawBombs(a){for(let b of this.bombs){b.draw(a)}}drawOutline(a){a.save();a.strokeStyle="#FF0000";a.strokeRect(this.x,this.y,this.width,this.height);a.restore()}draw(a){this.drawBombs(a);let b=this.imageMap[this.direction][this.action];let c=this.x,d=this.y,e=this.width,f=this.height;if(b.width>b.height){let a=this.width/b.width;e=this.width;f=b.height*a;c=this.x;d=this.y+(this.height-f)/2}else if(b.width<b.height){let a=this.height/b.height;f=this.height;e=b.width*a;c=this.x+(this.width-e)/2;d=this.y}a.drawImage(b,c,d,e,f)}}_defineProperty(Player,"size",50);_defineProperty(Player,"Direction",{South:"s",SouthWest:"sw",SouthEast:"se",West:"w",East:"e",North:"n",NorthWest:"nw",NorthEast:"ne"});_defineProperty(Player,"Action",{Open:"o",Closed:"c"});