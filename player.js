'use strict';function _defineProperty(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}import{Bomb}from"./bomb.js";export class Player{constructor(a,b,c,d){this.x=a;this.y=b;this.width=Player.size;this.height=Player.size;this.map=d;this.direction=Player.Direction.South;this.action=Player.Action.Closed;this.loadImages(c);this.lastBombCreatedTime=performance.now();this.bombs=[]}loadImages(a){this.imageMap={};this.imageMap[Player.Direction.South]={};this.imageMap[Player.Direction.SouthWest]={};this.imageMap[Player.Direction.SouthEast]={};this.imageMap[Player.Direction.West]={};this.imageMap[Player.Direction.East]={};this.imageMap[Player.Direction.North]={};this.imageMap[Player.Direction.NorthWest]={};this.imageMap[Player.Direction.NorthEast]={};this.imageMap[Player.Direction.South][Player.Action.Open]=this.loadImage(`${a}-south-open.png`);this.imageMap[Player.Direction.South][Player.Action.Closed]=this.loadImage(`${a}-south-closed.png`);this.imageMap[Player.Direction.SouthWest][Player.Action.Open]=this.loadImage(`${a}-southwest-open.png`);this.imageMap[Player.Direction.SouthWest][Player.Action.Closed]=this.loadImage(`${a}-southwest-closed.png`);this.imageMap[Player.Direction.SouthEast][Player.Action.Open]=this.loadImage(`${a}-southeast-open.png`);this.imageMap[Player.Direction.SouthEast][Player.Action.Closed]=this.loadImage(`${a}-southeast-closed.png`);this.imageMap[Player.Direction.West][Player.Action.Open]=this.loadImage(`${a}-west-open.png`);this.imageMap[Player.Direction.West][Player.Action.Closed]=this.loadImage(`${a}-west-closed.png`);this.imageMap[Player.Direction.East][Player.Action.Open]=this.loadImage(`${a}-east-open.png`);this.imageMap[Player.Direction.East][Player.Action.Closed]=this.loadImage(`${a}-east-closed.png`);this.imageMap[Player.Direction.North][Player.Action.Open]=this.loadImage(`${a}-north.png`);this.imageMap[Player.Direction.North][Player.Action.Closed]=this.loadImage(`${a}-north.png`);this.imageMap[Player.Direction.NorthWest][Player.Action.Open]=this.loadImage(`${a}-northwest-open.png`);this.imageMap[Player.Direction.NorthWest][Player.Action.Closed]=this.loadImage(`${a}-northwest-closed.png`);this.imageMap[Player.Direction.NorthEast][Player.Action.Open]=this.loadImage(`${a}-northeast-open.png`);this.imageMap[Player.Direction.NorthEast][Player.Action.Closed]=this.loadImage(`${a}-northeast-closed.png`)}loadImage(a){let b=new Image;b.src=a;return b}setDirectionWithHeading(a,b){if(a>0&&b>0){this.direction=Player.Direction.SouthEast}else if(a>0&&b<0){this.direction=Player.Direction.NorthEast}else if(a>0&&b===0){this.direction=Player.Direction.East}else if(a<0&&b>0){this.direction=Player.Direction.SouthWest}else if(a<0&&b<0){this.direction=Player.Direction.NorthWest}else if(a<0&&b===0){this.direction=Player.Direction.West}else if(a===0&&b>0){this.direction=Player.Direction.South}else if(a===0&&b<0){this.direction=Player.Direction.North}}isCombination(a,b,c,d){return a===c&&b===d||a===d&&b===c}setDirection(a,b){if(this.isCombination(a,b,Player.Direction.East,Player.Direction.North)){this.direction=Player.Direction.NorthEast}else if(this.isCombination(a,b,Player.Direction.East,Player.Direction.West)){this.direction=a}else if(this.isCombination(a,b,Player.Direction.East,Player.Direction.South)){this.direction=Player.Direction.SouthEast}else if(this.isCombination(a,b,Player.Direction.North,Player.Direction.South)){this.direction=a}else if(this.isCombination(a,b,Player.Direction.North,Player.Direction.West)){this.direction=Player.Direction.NorthWest}else if(this.isCombination(a,b,Player.Direction.South,Player.Direction.West)){this.direction=Player.Direction.SouthWest}else if(a){this.direction=a}}move(a,b,c){try{let d,e;if(a!==0){d=Math.max(0,Math.min(this.map.width-this.width,this.x+a))}if(b!==0){e=Math.max(0,Math.min(this.map.height-this.height,this.y+b))}if(a!==0||b!==0){const f=4;let g=false;let h=false;let i=null;let j=null;for(let c of this.map.blocks){if(a!==0&&!g&&c.hitTest(d+f,this.y+f,this.width-f*2,this.height-f*2)){g=true;i=c}if(b!==0&&!h&&c.hitTest(this.x+f,e+f,this.width-f*2,this.height-f*2)){h=true;j=c}if(h&&g)break}if(c===Player.Direction.East||c===Player.Direction.West){if(i){if(b!==0){if(j){this.move(a,0,c);return}}else if(this.y+this.height/2>i.y+i.height/2){this.move(0,Math.abs(a),c)}else{this.move(0,-Math.abs(a),c)}}}else if(c===Player.Direction.North||c===Player.Direction.South){if(j){if(a!==0){if(i){this.move(0,b,c);return}}else if(this.x+this.width/2>j.x+j.width/2){this.move(Math.abs(b),0,c)}else{this.move(-Math.abs(b),0,c)}}}if(a!==0&&!g){this.x=d}if(b!==0&&!h){this.y=e}}}finally{this.setDirectionWithHeading(a,b)}}fire(){if(performance.now()-this.lastBombCreatedTime>300){this.lastBombCreatedTime=performance.now();let a=this.x+(this.width-Bomb.size)/2,b=this.y+(this.height-Bomb.size)/2;if(this.direction===Player.Direction.East||this.direction===Player.Direction.West){a=this.x+this.width/2;b=this.y+this.height/2}let c=new Bomb(a,b,this.direction,this.map);this.bombs.push(c)}}updateBombs(a){let b=[];for(let c=this.bombs.length-1;c>=0;c--){let d=this.bombs[c];if(d.update(a)){b.push(c)}}for(let c of b){this.bombs.splice(c,1)}}drawBombs(a){for(let b of this.bombs){b.draw(a)}}drawOutline(a){a.save();a.strokeStyle="#FF0000";a.strokeRect(this.x,this.y,this.width,this.height);a.restore()}draw(a){this.drawBombs(a);let b=this.imageMap[this.direction][this.action];let c=this.x,d=this.y,e=this.width,f=this.height;if(b.width>b.height){let a=this.width/b.width;e=this.width;f=b.height*a;c=this.x;d=this.y+(this.height-f)/2}else if(b.width<b.height){let a=this.height/b.height;f=this.height;e=b.width*a;c=this.x+(this.width-e)/2;d=this.y}a.drawImage(b,c,d,e,f)}}_defineProperty(Player,"size",50);_defineProperty(Player,"Direction",{South:"s",SouthWest:"sw",SouthEast:"se",West:"w",East:"e",North:"n",NorthWest:"nw",NorthEast:"ne"});_defineProperty(Player,"Action",{Open:"o",Closed:"c"});